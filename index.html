<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>BoxTipping Ultimate</title>
<style>
body { margin:0; background:#111; font-family:Arial; text-align:center; color:white; overflow:hidden;}
canvas { display:block; margin:0 auto; background:#222; border:2px solid #555; }
button { padding:10px 20px; font-size:16px; margin:5px; border:none; border-radius:5px; cursor:pointer;}
#restartBtn { background:#f00; color:white; display:none; position:absolute; top:10px; left:10px;}
#menuBtn { background:#444; color:white; position:absolute; top:10px; left:120px;}
</style>
</head>
<body>

<h1>BoxTipping Ultimate</h1>
<canvas id="game" width="400" height="600"></canvas>
<button id="restartBtn">Restart</button>
<button id="menuBtn">Men체</button>

<script>
// ------------------------------
// VARIABLEN
// ------------------------------
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let score = 0, lives = 3, level = 1;
let gameRunning = true;
let payUnlocked = false;

// Spieler
const player = { x:180, y:550, w:40, h:40, speed:6 };

// Gegner & Endboss
let enemies = [];
let boss = null;

// Powerups & Waffen
let bullets = [];
let powerups = [];

// ------------------------------
// SPIELFUNKTIONEN
// ------------------------------
function spawnEnemy() {
    enemies.push({
        x: Math.random()*(canvas.width-40),
        y: -40,
        w:40,
        h:40,
        speed:2 + Math.random()*level*0.5
    });
}

function spawnBoss() {
    boss = {
        x: canvas.width/2 - 60,
        y: -100,
        w:120,
        h:80,
        hp: 20 + level*5,
        speed: 1 + level*0.2
    };
}

function resetGame() {
    score = 0;
    lives = 3;
    level = 1;
    gameRunning = true;
    payUnlocked = false;
    enemies = [];
    bullets = [];
    powerups = [];
    boss = null;
    player.x = canvas.width/2 - player.w/2;
    player.y = canvas.height - 120;
    restartBtn.style.display = "none";
}

// ------------------------------
// GAME LOOP
// ------------------------------
function gameLoop() {
    requestAnimationFrame(gameLoop);

    if(!gameRunning) return;

    // Hintergrund
    ctx.fillStyle="#222";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Spieler
    ctx.fillStyle="red";
    ctx.fillRect(player.x,player.y,player.w,player.h);

    // Gegner zeichnen
    for(let i=enemies.length-1;i>=0;i--){
        let e = enemies[i];
        e.y += e.speed;
        ctx.fillStyle="yellow";
        ctx.fillRect(e.x,e.y,e.w,e.h);

        if(e.y + e.h >= player.y &&
           e.x < player.x + player.w &&
           e.x + e.w > player.x){
            lives--;
            enemies.splice(i,1);
            if(lives<=0) {
                gameRunning=false;
                restartBtn.style.display="block";
            }
        }

        if(e.y>canvas.height){
            enemies.splice(i,1);
            score += 10;
        }
    }

    // Boss zeichnen
    if(level>=5 && !boss) spawnBoss();
    if(boss){
        boss.y += boss.speed;
        ctx.fillStyle="purple";
        ctx.fillRect(boss.x,boss.y,boss.w,boss.h);

        // Spieler-Kollision Boss
        if(boss.y + boss.h >= player.y &&
           boss.x < player.x + player.w &&
           boss.x + boss.w > player.x){
            lives=0;
            gameRunning=false;
            restartBtn.style.display="block";
        }
    }

    // Bullets & Powerups (Platzhalter)
    bullets.forEach(b=> ctx.fillRect(b.x,b.y,b.w,b.h));
    powerups.forEach(p=> ctx.fillRect(p.x,p.y,p.w,p.h));

    // Gegner nachspawnen
    if(enemies.length<3+level) spawnEnemy();

    // Paywall ab Level 4
    if(level>=4 && !payUnlocked){
        gameRunning=false;
        alert("Zahlung erforderlich um weiterzuspielen!");
        payUnlocked = true; // hier sp채ter ETH-Payment einf체gen
    }

    // Level hochsetzen
    if(score >= level*50){
        level++;
    }
}

// ------------------------------
// EVENTLISTENER
// ------------------------------
document.addEventListener("keydown",(e)=>{
    if(e.key==="ArrowLeft") player.x-=player.speed;
    if(e.key==="ArrowRight") player.x+=player.speed;
    if(player.x<0) player.x=0;
    if(player.x+player.w>canvas.width) player.x=canvas.width-player.w;
});

// Restart Button
const restartBtn = document.getElementById("restartBtn");
restartBtn.addEventListener("click", ()=>{
    resetGame();
    gameRunning=true;
});

// Men체 Button
const menuBtn = document.getElementById("menuBtn");
menuBtn.addEventListener("click",()=>{
    window.location.href="seite3.html";
});

// ------------------------------
// GAME START
// ------------------------------
gameLoop();
</script>

</body>
</html>

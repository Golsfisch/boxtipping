<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>BoxTipping</title>
<style>
body { margin:0; background:#111; color:white; font-family:Arial; text-align:center; }
canvas { background:#222; display:block; margin:20px auto; border:2px solid #555;}
#ui { font-size:18px; margin:10px; }
button {
  padding:10px 20px; font-size:18px; border:none; border-radius:6px;
  cursor:pointer; margin:5px;
}
#restartBtn { background:#f00; color:white; display:none; }
#menuBtn { background:#444; color:white; }
</style>
</head>
<body>

<h1>BoxTipping</h1>

<div id="ui">
Score: <span id="score">0</span> | 
Lives: <span id="lives">3</span> | 
Level: <span id="level">1</span>
</div>

<canvas id="game" width="400" height="600"></canvas>

<button id="restartBtn">Restart</button>
<button id="menuBtn">Menü</button>

<script>
// ------------------------------
// VARIABLEN
// ------------------------------
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let score = 0, lives = 3, level = 1;
let gameRunning = true;
let gameLoopID;

// Spieler
const player = { x:180, y:550, w:40, h:40, speed:6 };

// Gegner
let enemy = { x:180, y:0, w:40, h:40, speed:2 };

// Powerups und Bullets
let bullets = [];
let powerups = [];

// ------------------------------
// ------------------------------
// SICHERER GAME LOOP
// ------------------------------
let gameLoopID;
let gameRunning = true; // steuert, ob Update/Draw ausgeführt werden

function gameLoop() {
    gameLoopID = requestAnimationFrame(gameLoop); // Loop läuft immer

    if (!gameRunning) return; // Logik pausieren, Loop bleibt aktiv

    update(); // dein bestehendes Update
    draw();   // dein bestehendes Draw
}

// ------------------------------
// GAME OVER
// ------------------------------
function endGame() {
    gameRunning = false; // pausiert Logik
    document.getElementById("restartBtn").style.display = "block"; // Restart zeigen
}

// ------------------------------
// RESTART BUTTON
// ------------------------------
document.getElementById("restartBtn").addEventListener("click", () => {
    // 1️⃣ Variablen zurücksetzen
    lives = 3;
    gameOver = false;
    gameRunning = true;

    // Score/Level nach Paywall-Logik behalten oder zurücksetzen
    score = 0;    // wenn Score komplett zurückgesetzt werden soll
    level = 1;    // falls Level auf 1 zurück

    document.getElementById("score").textContent = score;
    document.getElementById("lives").textContent = lives;
    document.getElementById("level").textContent = level;

    // 2️⃣ Spieler zurücksetzen
    player.x = canvas.width / 2 - player.size / 2;
    player.y = canvas.height - 120;

    // 3️⃣ Gegner, Bullets, Powerups löschen
    enemies = [];
    bullets = [];
    powerups = [];

    // 4️⃣ Buttons ausblenden
    restartBtn.style.display = "none";

    // 5️⃣ Gegner neu spawnen, falls Funktion existiert
    if (typeof spawnEnemies === "function") spawnEnemies();

    // 6️⃣ Game Loop läuft weiter automatisch, kein RequestAnimationFrame neu nötig
});

// ------------------------------
// GAME START
// ------------------------------
gameLoop(); // einmal beim Laden starten
</script>

</body>
</html>
